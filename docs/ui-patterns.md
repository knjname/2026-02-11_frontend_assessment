# UIパターン

本プロジェクトの画面UIパターンを整理する。

## 全体レイアウト

```
+-------------------------------------------------------+
| Header (h-14, fixed top)                               |
|  [Sidebar Toggle (md:hidden)] ACME Admin    [UserMenu] |
+----------+--------------------------------------------+
| Sidebar  |  Content Area                               |
| (w-64)   |                                             |
| nav links|                                             |
|          |                                             |
+----------+--------------------------------------------+
```

- **Header**: アプリ名、モバイル時のサイドバートグル、ユーザーメニュー(ドロップダウン)
- **Sidebar**: shadcn/ui の `Sidebar` コンポーネント。デスクトップは常時表示、モバイル(< 768px)は `Sheet` でオーバーレイ表示
- **Content Area**: `SidebarInset` 内に `<main>` + `<footer>`

## 画面パターン一覧

| パターン | 画面例 | 特徴 |
|----------|--------|------|
| ダッシュボード | `/dashboard` | 統計カード群 + リスト表示。フルページレイアウト |
| Master-Detail | `/users`, `/todos`, `/audit-logs` | 左に一覧ペイン、右に詳細ペイン。CRUD画面の基本形 |
| ログイン | `/login` | 中央配置カード。認証済みレイアウトの外 |

### 1. ダッシュボードパターン

`p-6` パディングのフルページ。中身は自由配置。

```
+--------------------------------------------+
| h1: ダッシュボード                            |
| +--------+ +--------+ +--------+ +--------+ |
| | Stat   | | Stat   | | Stat   | | Stat   | |
| +--------+ +--------+ +--------+ +--------+ |
| +----------------------------------------+ |
| | Card: 最近のアクティビティ                   | |
| +----------------------------------------+ |
+--------------------------------------------+
```

レスポンシブグリッド (`grid sm:grid-cols-2 lg:grid-cols-4`) でカード数に応じて折り返す。特定のレイアウト制約はなく、個々の画面が自由にコンテンツを配置できる。

### 2. Master-Detail パターン (一覧画面の基本形)

3つの CRUD リソース（ユーザー / ToDo / 監査ログ）が全て同じ構造を取る。

```
+--------------------------------------------+
| List Pane (w-80)    | Detail Pane (flex-1)  |
|                     |                       |
| +--Header---------+ | (選択なし時)            |
| | Title (件数)     | | EmptyState            |
| | [+新規] ボタン   | |                       |
| +-----------------+ | (選択時)               |
| +--Filters--------+ | Card                  |
| | 検索 input      | |  CardHeader: タイトル  |
| | Select filters  | |  CardContent: Form    |
| +-----------------+ |                       |
| +--ScrollArea-----+ |                       |
| | Item row        | |                       |
| | Item row (sel)  | |                       |
| | Item row        | |                       |
| +-----------------+ |                       |
+--------------------------------------------+
```

#### 構成要素と役割

| 要素 | ファイル命名規則 | 役割 |
|------|------------------|------|
| レイアウトルート | `routes/_authenticated/{resource}.tsx` | Zod で検索パラメータをバリデーション、TanStack Query でデータ取得、`MasterDetailLayout` に一覧と詳細を配置 |
| `MasterDetailLayout` | `components/master-detail-layout.tsx` | 左右分割の汎用レイアウト。左 `w-80` 固定、右 `flex-1` |
| ListHeader | `features/{resource}/{resource}-list-header.tsx` | タイトル (件数表示)、新規作成ボタン、検索 input、フィルター Select |
| ListBody | `features/{resource}/{resource}-list-pane.tsx` | `ScrollArea` 内でアイテムをリスト表示。選択状態をハイライト。空の場合はメッセージ |
| Detail | `features/{resource}/{resource}-detail.tsx` | `Card` 内に読み取り専用情報 + 編集フォーム + 削除ボタン |
| CreateForm | `features/{resource}/{resource}-create-form.tsx` | 新規作成フォーム。`Card` 内に配置 |
| EmptyState | `components/empty-state.tsx` | 未選択時のプレースホルダー |
| Skeleton | `features/{resource}/*-skeleton.tsx` | ローディング中の仮表示 |

#### 検索・フィルタリング

- **検索パラメータ**: URL のクエリ文字列で管理 (`Route.useSearch()`)。Zod スキーマで型安全にバリデーション
- **テキスト検索**: `useDebouncedCallback` で 300ms デバウンス
- **セレクトフィルター**: 即時反映。リソースごとにフィルター項目が異なる
- **ページネーション**: `page` パラメータ。フィルター変更時は `page: 1` にリセット
- **データ保持**: `keepPreviousData` でフィルター変更時のチラつき防止

#### 詳細ペインの3状態

1. **未選択**: `EmptyState` で「選択してください」メッセージ
2. **ローディング**: `pendingComponent` でスケルトン表示 (200ms 遅延、最低 300ms 表示)
3. **表示中**: 詳細 or 新規作成フォーム

#### CRUD 操作のフロー

- **Read**: レイアウトルートの `useQuery` で一覧取得。詳細は `$param` ルートの `loader` で個別取得
- **Create**: `/new` ルートで作成フォーム表示。成功時に一覧を `invalidateQueries` して作成したアイテムの詳細に遷移
- **Update**: 詳細画面内のインライン編集フォーム。成功時に `invalidateQueries`
- **Delete**: `ConfirmDialog` で確認後に削除。成功時に一覧 (`/resource`) へ遷移し `invalidateQueries`

### 3. フォームパターン

全フォームで共通の構成:

- **React Hook Form** + **Zod** でバリデーション
- **共通フォームフィールドコンポーネント**: `FormTextField`, `FormTextareaField`, `FormSelectField`
- **送信中の状態**: ボタンに `disabled` + 「保存中...」「作成中...」テキスト
- **トースト通知**: 成功 / エラー時に `sonner` で表示
- **キャッシュ更新**: `queryClient.invalidateQueries()` で関連データを再取得

### 4. 共通UIコンポーネント

| コンポーネント | 用途 |
|----------------|------|
| `Card` / `CardHeader` / `CardContent` | 詳細・フォームの外枠 |
| `Badge` | ステータス・ロールなどのラベル表示 |
| `Button` | アクション。`variant` で種類を分ける |
| `ConfirmDialog` | 削除確認ダイアログ |
| `EmptyState` | 未選択時のプレースホルダー |
| `ScrollArea` | 一覧ペインのスクロール領域 |
| `Select` | フィルターやフォームのセレクトボックス |

---

## 管理画面UIとしての評価

### このパターンが適している場面

Master-Detail パターンは「少数のフィールドを持つリソースを一覧し、選んで編集する」という管理画面の王道操作に適合する。メールクライアント (Outlook, Gmail) やファイラーと同じメンタルモデルなので、ユーザーが迷わない。

具体的な利点:

- **画面遷移が少ない**: 一覧と詳細が同一画面にあるため、複数アイテムを続けて確認・編集する際にストレスがない
- **コンテキスト維持**: 一覧のフィルター状態が常に見えているので「今何を見ているか」が分かりやすい
- **パターンの統一**: 全 CRUD リソースが同じレイアウト構造を共有しているため、ユーザーの学習コストが低い
- **実装コスト**: `MasterDetailLayout` 1つ + feature 単位のファイル分割で、新しいリソース画面の追加が機械的にできる

### 限界・弱点

**1. 左ペインの幅が固定 (`w-80` = 320px)**

一覧で表示できる情報量に上限がある。テーブル的なカラム表示（複数フィールドを横並びで比較したい場合）には向かない。例えば「全ユーザーのメールアドレスとロールと最終ログイン日時を横並びで眺めたい」といった操作は今のパターンでは困難。

**2. モバイル対応が構造的に弱い**

320px 固定の左ペインは狭い画面では破綻する。現状レスポンシブ対応されておらず、モバイルでは左右パネルがそのまま詰まる。モバイル対応するなら一覧→詳細のページ遷移型に切り替えるか、左ペインをドロワー化する必要がある。

**3. 複雑な詳細画面になると右ペインが窮屈**

現状の詳細画面はフィールド数が少ないので `Card` 1枚で足りているが、リレーション先のテーブルや、タブ切り替え、複数セクションのフォームなどが必要になると、右ペインの横幅だけでは足りなくなる可能性がある。

### 改善の方向性（ローコスト → ハイコスト順）

**そのままで十分なもの:**
- 今の規模（3リソース、フィールド数 5前後）であれば、このパターンで過不足ない
- 同程度の粒度のリソースが増えても、コピー＆ペーストで画面を増やせる

**ローコストな改善:**
- 一覧ペインのレスポンシブ化（モバイルでは一覧・詳細をページ遷移に切り替え or 左ペインを折りたたみ可能に）
- 一覧の並び替え対応（ヘッダークリックでソート）

**ミドルコスト（必要になったら）:**
- テーブル表示モードの追加（一覧を `Table` コンポーネントで横並び表示。TanStack Table などを利用）
- 詳細ペインにタブを導入して複数セクションを切り替え

**ハイコスト（個別画面に閉じた対応で可能）:**
- ドラッグ＆ドロップによる並び替えや、カンバンボード表示
- インラインセル編集可能なテーブルビュー
- 複雑なフォーム（動的フィールド追加、ネストされたサブフォーム、ウィザード形式）

### 複雑な個別画面への対応力

結論から言えば、**個別画面単位で複雑なUIを導入する能力はある**。

理由:
- `SidebarInset` 内の `<main>` に何を描画するかはルート単位で完全に自由
- 例えばダッシュボードは既に Master-Detail とは全く異なるレイアウトを使っている
- 特定のルートだけ `MasterDetailLayout` を使わず、フルページのテーブルビューやカンバンボードを配置することは、ルーティング構造を変えずに可能
- shadcn/ui は Radix UI プリミティブの集合体なので、Tabs / Accordion / DataTable / DnD など必要なコンポーネントを個別に追加できる
- TanStack Router のネストルーティングにより、特定リソースだけ独自のレイアウト構造を持たせることもできる

つまり、「基本は Master-Detail で素朴に量産し、特殊な画面だけ個別にリッチなUIを組む」というアプローチが無理なく取れる構成になっている。
